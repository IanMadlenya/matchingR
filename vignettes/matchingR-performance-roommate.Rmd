---
title: 'Solving the stable roommate problem in R: Performance'
author: '[Jan Tilly](mailto:jtilly@econ.upenn.edu)'
date: "July 31, 2015"
output: html_document
bibliography: bibliography.bib
vignette: |
  %\VignetteIndexEntry{Solving the stable roommate problem in R: Performance} %\VignetteEngine{knitr::rmarkdown} \usepackage[utf8]{inputenc}
---

```{r, results = "hide", echo=FALSE, message = FALSE}
library(matchingR)
library("ggplot2")
```

In this vignette, I explore the computational performance of the Irving algorithm [@irving1985roommates] implemented in this package. Existence of a stable matching is not guaranteed, and indeed for large markets, can be very likely to not exist. Therefore, there are two relevant measures of speed to be considered: First, the average time to find a stable matching or to verify that no stable matching exists, and second, the average time to find a stable matching, conditional on such a matching existing. 

The code to find a stable matching, from the documentation, is
```{r}
p = replicate(4, rnorm(3))
results = onesided(prefUtil = p)
```
The function we use to benchmark is
```{r, echo=FALSE}
test_roommate = function(n) {
    p = replicate(2*n, rnorm(2*n-1))
    results = onesided(prefUtil = p)
}
```
That is, $n$ represents the number of rooms available.
```{r, cache=TRUE, echo=FALSE}
N = c(100, 200, 300, 400, 500, 600, 700, 800)
res = microbenchmark::microbenchmark(
    test_roommate(N[1]),
    test_roommate(N[2]),
    test_roommate(N[3]),
    test_roommate(N[4]),
    test_roommate(N[5]),
    test_roommate(N[6]),
    test_roommate(N[7]),
    test_roommate(N[8]), times = 5, unit = "s")
```

```{r, echo=FALSE}
plot(
    x = N,
    y = summary(res)$mean,
    lwd = 4,
    xlab = "Market size",
    ylab = "Time (s)",
    type = 'l'
)
title("Average time to find stable matching or verify that no stable matching exists")
```

```{r, cache=TRUE, echo=FALSE}
N = c(10, 20, 30, 40, 50, 60, 70, 80, 90)
tot_exis = rep(0, 9);
for (n in 1:9) {
    for (i in 1:50) {
        p = replicate(2*N[n], rnorm(2*N[n]-1))
        p = validateInputsOneSided(prefUtil = p)
        #results = onesided(pref = p)
        checkStabilityRoommate(pref = p, matchings = results)
        if (is.integer(results)) {
            tot_exis[n] = tot_exis[n] + 1;
        }
    }
}

```